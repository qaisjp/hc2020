(this.webpackJsonphc2020=this.webpackJsonphc2020||[]).push([[0],{1489:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=1489},1490:function(e,t,n){"use strict";n.r(t);var i=n(66),o=n.n(i),a=n(560),s=n.n(a),c=(n(569),n(570),n(31)),r=n(34),l=n(77),u=n(42),d=n(78),h=n(43),v=n.n(h),f=n(561),y=n.n(f),p=n(32),m=n.n(p),g=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"peer";Object(c.a)(this,e),this.id=void 0,this.dataConnection=void 0,this.name=void 0,this.id=t,this.dataConnection=n,this.name=i}return Object(r.a)(e,[{key:"send",value:function(e,t,n){this.dataConnection.send(m.a.extend(n,{from:e,type:t}))}},{key:"on",value:function(e,t){this.dataConnection.on(e,t)}},{key:"destroy",value:function(){this.dataConnection.destroy()}}]),e}(),_="open",b="connection",k="close",w="data",P="error",x=0,j=1,O=2,T=3;function S(e){var t=this;console.log("Connected to PeerServer with id: ".concat(e)),console.log(this),this._id=e,this._signals[_].dispatch(e),this.getAllPeers((function(e){var n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;t.connectToPeer(c)}}catch(r){i=!0,o=r}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}}))}function E(e){var t=this;console.log("".concat(e.peer," connected to us")),e.on(w,(function(e){return B.call(t,e)})),e.on(k,(function(){return G.call(t,e.peer)})),e.on(P,(function(e){return C.call(t,e)})),m.a.has(this._signals,b)&&this._signals[b].dispatch(e.peer)}function C(e){console.log(e)}function B(e){var t=e.type;m.a.isUndefined(t)?console.log("Error: unrecognised message with type: ".concat(t)):this._signals[w].dispatch(t,e)}function G(e){m.a.has(this.connectedPeers,e)&&(delete this.connectedPeers[e],this._signals[k].dispatch(e))}var L=n(562),M=n.n(L),U=window.location.hostname,A=window.location.protocol,F="".concat("/multi","/peerjs/peers"),D=function(){function e(){Object(c.a)(this,e),this.dispatchers=[],this.dispatchers=[]}return Object(r.a)(e,[{key:"add",value:function(e,t){this.dispatchers.push({func:e,ctx:t})}},{key:"dispatch",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,o=this.dispatchers[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value,s=a.func.bind(a.ctx);s.apply(void 0,arguments)}}catch(c){t=!0,n=c}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}}]),e}(),I=function(){function e(t){Object(c.a)(this,e),this.peer=void 0,this._level=void 0,this.connectedPeers=void 0,this._id=void 0,this._signals=void 0,this.peer=new M.a({host:U,port:parseInt("9000"),path:"/multi"}),this._level=t,this.connectedPeers={},this._id="",this._signals={},this._addEventListeners()}return Object(r.a)(e,[{key:"addListener",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._signals[e]=new D,this._signals[e].add(t,n)}},{key:"getAllPeers",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=new XMLHttpRequest,o="".concat(A,"//").concat(U,":").concat("9000").concat(F);i.onreadystatechange=function(o){if(4===i.readyState&&200===i.status){var a=m.a.reject(JSON.parse(i.responseText),(function(e){return e===t._id}));e.call(n,a)}},i.open("GET",o,!0),i.send()}},{key:"broadcastToPeers",value:function(e,t){var n=this;m.a.each(this.connectedPeers,(function(i){i.send(n._id,e,t)}))}},{key:"sendToPeer",value:function(e,t,n){m.a.has(this.connectedPeers,e)?this.connectedPeers[e].send(this._id,t,n):console.log("Error: not connected to peer ".concat(e))}},{key:"connectToPeer",value:function(e){var t=this;if(!m.a.has(this.connectedPeers,e)){var n=this.peer.connect(e);console.log("Connecting to peer: ".concat(e)),this.connectedPeers[e]=new g(e,n),this.connectedPeers[e].on(_,(function(n){t.sendToPeer(e,x,{x:t._level.localPlayer.x,y:t._level.localPlayer.y})}))}}},{key:"destroy",value:function(){this.peer&&!this.peer.destroyed&&this.peer.destroy()}},{key:"_addEventListeners",value:function(){var e=this;this.peer.on("open",(function(t){return S.call(e,t)})),this.peer.on("connection",(function(t){return E.call(e,t)})),this.peer.on("error",(function(e){return C(e)}))}}]),e}(),N=n(168),V=function(e){function t(e,n,i,o){var a,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=(arguments.length>5&&void 0!==arguments[5]&&arguments[5],!(arguments.length>6&&void 0!==arguments[6])||arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:1),d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:8;return Object(c.a)(this,t),a=Object(l.a)(this,Object(u.a)(t).call(this,e,n,i,"plumber_bros",o,d)),s&&s.add(Object(N.a)(a)),a.align=r,a}return Object(d.a)(t,e),t}(v.a.GameObjects.BitmapText),H=n(563),W=function(e){function t(e,n,i){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"local",s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return Object(c.a)(this,t),(o=Object(l.a)(this,Object(u.a)(t).call(this,e,n,i,"playersheet",0,1))).id=void 0,o.jumpReleased=void 0,o._prevFacing=void 0,o._jumping=void 0,o._grounded=void 0,o._sprinting=void 0,o._turning=void 0,o._moving=void 0,o.cursors=void 0,o._velocity=void 0,o._accel=void 0,o.isPlayer=void 0,o.id=a,o.isPlayer=s,o.jumpReleased=!0,o.facing=Phaser.RIGHT,o._prevFacing=o.facing,o._jumping=!1,o._grounded=!1,o._sprinting=!1,o._turning=!1,o._moving=[],o._addAnimations([{name:"walk",frames:[1,2,3]}],8,!0),o}return Object(d.a)(t,e),Object(r.a)(t,[{key:"setup",value:function(e){if(Object(H.a)(Object(u.a)(t.prototype),"setup",this).call(this,e),this.cursors=this.scene.input.keyboard.createCursorKeys(),this.body){var n=this.body;this._velocity=n.velocity,this._accel=n.acceleration,n.setSize(n.width-2,n.height)}}},{key:"update",value:function(){if(this.cursors&&this.body&&this.isPlayer){var e=this.body;this.cursors.left&&this.cursors.left.isDown?e.setVelocityX(-200):this.cursors.right&&this.cursors.right.isDown?e.setVelocityX(200):e.setVelocityX(0),this.cursors.down&&this.cursors.down.isDown?e.setVelocityY(200):this.cursors.up&&this.cursors.up.isDown?e.setVelocityY(-200):e.setVelocityY(0)}}},{key:"jump",value:function(){}},{key:"sprint",value:function(e){}},{key:"move",value:function(e,t){}},{key:"_updateAnimations",value:function(){}}]),t}(function(e){function t(e,n,i,o,a){var s,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return Object(c.a)(this,t),(s=Object(l.a)(this,Object(u.a)(t).call(this,e,n,i,o,a))).moveSpeed=void 0,s.facing=void 0,s.moveSpeed=r,s.facing=v.a.LEFT,s}return Object(d.a)(t,e),Object(r.a)(t,[{key:"setup",value:function(e){e.physics.world.enable(this),e.add.existing(this)}},{key:"pause",value:function(){}},{key:"resume",value:function(){}},{key:"flip",value:function(){this.facing,v.a.LEFT}},{key:"_addAnimations",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2]}}]),t}(v.a.GameObjects.Sprite)),R=function(){function e(t,n){var i=this;Object(c.a)(this,e),this.network=void 0,this.remotePlayers=void 0,this._connectionStatusText=void 0,this._entitiesGroup=void 0,this._physics=void 0,this.localPlayer=void 0,this.blocksGroup=void 0,this.itemBlocksGroup=void 0,this.game=void 0,this.scene=void 0,this.broadcastTimer=void 0,this.game=t,this.scene=n,this.network=null,this.remotePlayers=null,this._connectionStatusText=null,window.onunload=window.onbeforeunload=function(e){return i._disconnect()},console.log(n),this._entitiesGroup=this.scene.add.group(),this._createWorld()}return Object(r.a)(e,[{key:"shutdown",value:function(){this.remotePlayers.destroy()}},{key:"_createWorld",value:function(){this.network=new I(this),this._connectionStatusText=new V(this.scene,16,16,"connecting...",null,!0,!1,0),this.scene.add.existing(this._connectionStatusText),this.remotePlayers=this.scene.add.group(),this.network.addListener(_,this._onOpen,this),this.network.addListener(w,this._onData,this),this.network.addListener(k,this._onClose,this),this.localPlayer=new W(this.scene,32,100,"local",!0),this.localPlayer.setup(this.scene),this.scene.cameras.main.startFollow(this.localPlayer),this._entitiesGroup.add(this.localPlayer),this.broadcastTimer=this.scene.time.addEvent({delay:20,callback:this._broadcastPlayerUpdate,callbackScope:this,loop:!0})}},{key:"_createMap",value:function(){throw new Error("Method not implemented.")}},{key:"_createMapObjects",value:function(){throw new Error("Method not implemented.")}},{key:"_updateCollision",value:function(){}},{key:"_collisionLayer",value:function(e,t){throw new Error("Method not implemented.")}},{key:"_updateEntities",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,o=this._entitiesGroup.getChildren()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){i.value.update()}}catch(a){t=!0,n=a}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}this._broadcastPlayerUpdate()}},{key:"update",value:function(){this._updateEntities()}},{key:"_broadcastPlayerUpdate",value:function(){var e=this.localPlayer.body;this.network.broadcastToPeers(j,{facing:this.localPlayer.facing,state:this.localPlayer.currentState,x:Math.round(this.localPlayer.x),y:Math.round(this.localPlayer.y),v:e.velocity.y.toFixed(2),a:e.acceleration.x.toFixed(2)})}},{key:"_disconnect",value:function(){this.network.destroy()}},{key:"_onOpen",value:function(e){var t=this;this._connectionStatusText.setText("connected, id: ".concat(e)),this.scene.time.delayedCall(5e3,(function(e){return t._connectionStatusText.visible=!1}))}},{key:"_onData",value:function(e,t){var n=m.a.find(this.remotePlayers.getChildren(),(function(e){return e.id===t.from}));switch(e){case x:this._handleHello(t);break;case j:this._handlePlayerUpdate(n,t);break;case O:this._handleBlockBump(t);break;case T:this._handleItemBlockBump(t)}}},{key:"_onClose",value:function(e){var t=m.a.find(this.remotePlayers.getChildren(),(function(t){return t.id===e}));m.a.isUndefined(t)||this.remotePlayers.children.iterate((function(t){t.id===e&&t.destroy()}))}},{key:"_onBlockBump",value:function(e,t){e.body.touching.up&&this.network.broadcastToPeers(O,{idx:this.blocksGroup.getChildIndex(t)})}},{key:"_onItemBlockBump",value:function(e,t){e.body.touching.up&&this.network.broadcastToPeers(T,{idx:this.itemBlocksGroup.getChildIndex(t)})}},{key:"_handleHello",value:function(e){var t=this;console.log("hello from: ".concat(e.from)),this.network.connectToPeer(e.from),this._connectionStatusText.visible=!0,this._connectionStatusText.setText("player joined"),this.scene.time.delayedCall(5e3,(function(e){return t._connectionStatusText.visible=!1}));var n=new W(this.scene,e.x,e.y,e.from);n.setup(this.scene),this.remotePlayers.add(n),this._entitiesGroup.add(n)}},{key:"_handlePlayerUpdate",value:function(e,t){var n=e.body;e.facing=t.facing,e.currentState=t.state,e.x=t.x,e.y=t.y,n.velocity.y=t.v,n.acceleration.x=t.a}},{key:"_handleBlockBump",value:function(e){this.blocksGroup.getAt(e.idx).bump()}},{key:"_handleItemBlockBump",value:function(e){this.itemBlocksGroup.getAt(e.idx).bump()}}]),e}(),X=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this,"MyScene"))).manager=void 0,e}return Object(d.a)(t,e),Object(r.a)(t,[{key:"preload",value:function(){this.load.image("logo",y.a),this.load.bitmapFont("plumber_bros","res/fonts/plumber_bros.png","res/fonts/plumber_bros.xml")}},{key:"update",value:function(){this.manager&&this.manager.update()}},{key:"create",value:function(){this.manager=new R(this.game,this)}}]),t}(v.a.Scene),z=function(){return Object(i.useEffect)((function(){var e;window.addEventListener("resize",(function(){e.scale.resize(window.innerWidth,window.innerHeight)}));var t={type:v.a.AUTO,parent:"phaser-example",width:1920,height:1080,scene:X,scale:{mode:v.a.Scale.NONE},physics:{default:"arcade",arcade:{debug:!0}}};return e=new v.a.Game(t),function(){}}),[]),o.a.createElement("div",{id:"phaser-example"})},J=function(){return o.a.createElement("div",{className:"App"},o.a.createElement(z,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(J,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},561:function(e,t,n){e.exports=n.p+"static/media/img.a16fe9ef.jpg"},564:function(e,t,n){e.exports=n(1490)},569:function(e,t,n){},570:function(e,t,n){}},[[564,1,2]]]);
//# sourceMappingURL=main.ab941c01.chunk.js.map